t1 <- gatherModelStats(i)
gatherModelStats <- function(species){
# base path
p1 <- paste0("data/Vitis/", i,"/run08282025_1k")
# AUC data
p2 <- paste0(p1, "/results/evaluationTable.csv")
# variable selection
p3 <- paste0(p1, "/occurances/variableSelectionData.csv")
# export
output  <- list(
auc = read_csv(p2),
varSelection = read_csv(p3)
)
return(output)
}
t1 <- gatherModelStats(i)
t1
results <- purrr::map(.x = species, .f = gatherModelStats)
results
gatherModelStats <- function(species){
# base path
p1 <- paste0("data/Vitis/", species,"/run08282025_1k")
# AUC data
p2 <- paste0(p1, "/results/evaluationTable.csv")
# variable selection
p3 <- paste0(p1, "/occurances/variableSelectionData.csv")
# export
output  <- list(
auc = read_csv(p2),
varSelection = read_csv(p3)
)
return(output)
}
results <- purrr::map(.x = species, .f = gatherModelStats)
species <-"Vitis jaegeriana"
# base path
p1 <- paste0("data/Vitis/", species,"/run08282025_1k")
p1
# AUC data
p2 <- paste0(p1, "/results/evaluationTable.csv")
p1
gatherModelStats <- function(species){
# output list
# base path
p1 <- paste0("data/Vitis/", species,"/run08282025_1k")
# AUC data
p2 <- paste0(p1, "/results/evaluationTable.csv")
if(!file.exists(p2)){
next()
}
# variable selection
p3 <- paste0(p1, "/occurances/variableSelectionData.csv")
# export
output  <- list(
auc = read_csv(p2),
varSelection = read_csv(p3)
)
return(output)
}
t1 <- gatherModelStats(i)
t1
speciesData
gatherModelStats(speciecs)
gatherModelStats(species)
gatherModelStats <- function(species){
# output list
# base path
p1 <- paste0("data/Vitis/", species,"/run08282025_1k")
# AUC data
p2 <- paste0(p1, "/results/evaluationTable.csv")
if(!file.exists(p2)){
return(NULL)
}
# variable selection
p3 <- paste0(p1, "/occurances/variableSelectionData.csv")
# export
output  <- list(
auc = read_csv(p2),
varSelection = read_csv(p3)
)
return(output)
}
results <- purrr::map(.x = species, .f = gatherModelStats)
species
results
# load in species
species <- read_csv(
"data/datasetsForPublication/allSpeciesOccurrences.csv"
)|>
dplyr::distinct(taxon) |>
tidyr::drop_na()|>
dplyr::pull()
results <- purrr::map(.x = species, .f = gatherModelStats)
results
names(results)
results$auc
# 2. Extract and combine the 'auc' dataframes
all_auc <- results |>
purrr::map("auc") |>  # Extract the 'auc' element from every sub-list
purrr::list_rbind(names_to = "species") # Combine and create ID column
all_auc
View(all_auc)
gatherModelStats <- function(species){
# output list
# base path
p1 <- paste0("data/Vitis/", species,"/run08282025_1k")
# AUC data
p2 <- paste0(p1, "/results/evaluationTable.csv")
if(!file.exists(p2)){
return(NULL)
}
# variable selection
p3 <- paste0(p1, "/occurances/variableSelectionData.csv")
# export
output  <- list(
auc = read_csv(p2) |>
dplyr::mutate(taxon = species),
varSelection = read_csv(p3)|>|>
species
results <- purrr::map(.x = species, .f = gatherModelStats)
species
results[[1]]
results[[1]]$auc
names(results[[1]]$auc)
gatherModelStats <- function(species){
# output list
# base path
p1 <- paste0("data/Vitis/", species,"/run08282025_1k")
# AUC data
p2 <- paste0(p1, "/results/evaluationTable.csv")
if(!file.exists(p2)){
return(NULL)
}
# variable selection
p3 <- paste0(p1, "/occurances/variableSelectionData.csv")
# export
output  <- list(
auc = read_csv(p2) |>
dplyr::mutate(taxon = species),
varSelection = read_csv(p3)|>
dplyr::mutate(taxon = species)
)
return(output)
}
results <- purrr::map(.x = species, .f = gatherModelStats)
names(results[[1]]$auc)
# 2. Extract and combine the 'auc' dataframes
all_auc <- results |>
purrr::map("auc") |>  # Extract the 'auc' element from every sub-list
purrr::list_rbind(names_to = "species") # Combine and create ID column
# 2. Extract and combine the 'auc' dataframes
all_auc <- results |>
purrr::map("auc") |>  # Extract the 'auc' element from every sub-list
purrr::list_rbind(names_to = "species") |>
dplyr::select(
"taxon",  "AUCtrain", "AUCtest", "nAUC", "cAUC", "sensi_train", "speci_train", "threshold_train", "max.TSS_train",
,"minROCdist_train","method_train","threshold_test","sensi_test","speci_test","matthews.cor_test", "LR_pos_test","LR_neg_test"
, "kappa_index_test"
)
View(all_auc)
# 2. Extract and combine the 'auc' dataframes
all_auc <- results |>
purrr::map("auc") |>  # Extract the 'auc' element from every sub-list
purrr::list_rbind(names_to = "species") |>
dplyr::select(
"taxon", everything()
)
# 2. Extract and combine the 'auc' dataframes
all_auc <- results |>
purrr::map("auc") |>  # Extract the 'auc' element from every sub-list
purrr::list_rbind(names_to = "species") |>
dplyr::select(
"taxon", everything(), -species
)
# 3. Extract and combine the 'varSelection' dataframes
all_vars <- results_list |>
purrr::map("varSelection") |>
purrr::list_rbind(names_to = "species") |>
dplyr::select(
"taxon", everything(), -species
)
# 3. Extract and combine the 'varSelection' dataframes
all_vars <- results |>
purrr::map("varSelection") |>
purrr::list_rbind(names_to = "species") |>
dplyr::select(
"taxon", everything(), -species
)
all_vars
View(all_vars)
# 2. Extract and combine the 'auc' dataframes
all_auc <- results |>
purrr::map("auc") |>  # Extract the 'auc' element from every sub-list
purrr::list_rbind(names_to = "species") |>
dplyr::select(
"taxon", everything(), -species
)
View(all_auc)
# 3. Extract and combine the 'varSelection' dataframes
all_vars <- results |>
purrr::map("varSelection") |>
purrr::list_rbind(names_to = "species") |>
dplyr::select(
"taxon", everything(), -species
)
View(all_vars)
results <- purrr::map(.x = species, .f = gatherModelStats)
# 3. Extract and combine the 'varSelection' dataframes
all_vars <- results |>
purrr::map("varSelection") |>
purrr::list_rbind(names_to = "species") |>
dplyr::select(
"taxon", everything(), -species
)
write_csv(all_auc, "data/datasetsForPublication/modelEvaluations.csv")
write_csv(all_auc, "data/datasetsForPublication/variableSelections.csv")
library(readr)
protectedAreaSpeciesRichness <- read_csv("data/Vitis/run08282025_1k/protectedAreaSpeciesRichness.csv")
View(protectedAreaSpeciesRichness)
pacman::p_load(dplyr, readr)
inputData <- read_csv("~/trueNAS/work/cwr_wildgrapes/data/datasetsForPublication/allSpeciesOccurrences.csv")
inputData
View(inputData)
names(inputData)
inputData <- read_csv("~/trueNAS/work/cwr_wildgrapes/data/datasetsForPublication/allSpeciesOccurrences.csv") |>
dplyr::filter(type == "G")
inputdata
inputData
summary_counts <- your_dataframe_name |>
dplyr::count(databaseSource, institutionCode, sort = TRUE)
print(summary_counts)
summary_counts <- inputData |>
dplyr::count(databaseSource, institutionCode, sort = TRUE)
summary_counts
View(inputData)
View(summary_counts)
# group germplasm data by the database sources
db_source  <- inputData |>
dplyr::count(databaseSource, sourt = TRUE)
db_source
# group germplasm data by the database sources
db_source  <- inputData |>
dplyr::count(databaseSource, sort = TRUE)
View(db_source)
print(summary_counts)
View(summary_counts)
names(inputData)
# grouping by species
db_source  <- inputData |>
dplyr::count(databaseSource, taxon, sort = TRUE)
db_source
# grouping by species
db_bySpecies  <- inputData |>
dplyr::count(databaseSource, taxon, sort = TRUE)
grouped_df <- inputData |>
dplyr::group_by(databaseSource, institutionCode) |>
# Example: create a column with the number of records for that group
dplyr::mutate(records_in_group = n()) |>
# Example: collapse unique taxa into a string
dplyr::summarise(
unique_taxa = paste(unique(taxon), collapse = ", "),
total_records = n(),
.groups = "drop"
)
inputData
bySpecies2 <- inputData |>
dplyr::group_by(databaseSource, institutionCode) |>
# Example: create a column with the number of records for that group
dplyr::mutate(records_in_group = n()) |>
# Example: collapse unique taxa into a string
dplyr::summarise(
unique_taxa = paste(unique(taxon), collapse = ", "),
total_records = n(),
.groups = "drop"
)
bySpecies2
bySpecies2 <- inputData |>
dplyr::group_by(databaseSource, institutionCode) |>
# Example: create a column with the number of records for that group
dplyr::mutate(records_in_group = n()) |>
# Example: collapse unique taxa into a string
dplyr::summarise(
unique_taxa = paste(unique(taxon), collapse = ", "),
total_records = n(),
n_unique_species = dplyr::n_distinct(species), # <--- Counts unique species
.groups = "drop"
)
bySpecies2
View(bySpecies2)
# grouping by species
db_bySpecies  <- inputData |>
dplyr::count(databaseSource, taxon, sort = TRUE)
View(bd_bySpecies)
View(db_bySpecies)
pacman::p_load(terra, dplyr)
dir1 = dir1;
#     runVersion = runVersion;
#     species = s2$taxon;
#     genus = "Vitis";
#     protectedAreas = protectedAreas;
#     overwrite = FALSE
dir1 = dir1;
runVersion = runVersion;
species = s2$taxon;
genus = "Vitis";
protectedAreas = protectedAreas;
overwrite = FALSE
# storing summaries data in run folders
dir2 <- paste0(dir1, "/", runVersion)
# generate summary of all the models --------------------------------------
path1 <- paste0(dir2,"/speciesrichness.tif")
path2 <- paste0(dir2,"/speciesUsed_speciesrichness.csv")
path3 <- paste0(dir2,"/ga50_speciesrichness.tif")
path4 <- paste0(dir2, "/ga50speciesUsed_speciesrichness.csv")
path5 <- paste0(dir2,"/protectedAreaSpeciesRichness.csv")
path6 <- paste0(dir2,"/ersexRichness.tif")
path7 <- paste0(dir2,"/ersex_speciesUsed_Richness.csv")
path8 <- paste0(dir2,"/ersinRichness.tif")
path9 <- paste0(dir2,"/ersin_speciesUsed_Richness.tif")
path10 <- paste0(dir2,"/protectedAreaSpeciesPointRichness.csv")
# Testing the presense of species in the summary maps
t1 <- read_csv(path10)
# generate conservation summary figures
conservationSummary <- compileConservationData(directory = dir1,
runVersion = runVersion,
genus = genus)
# add additional object to the list to be passed to the rmd
conservationSummary$map <- rast(path1)
conservationSummary$proAreas <- protectedAreas
conservationSummary$ga50Map <- rast(path3)
conservationSummary$protectAreasRichness <- read_csv(path5)
conservationSummary$ersExRichness <- terra::rast(path6)
conservationSummary$ersInRichness <- terra::rast(path8)
conservationSummary$genus <- genus
# run summary html
try(
rmarkdown::render(input = "R2/summarize/runSummary.Rmd",
output_format = "html_document",
output_dir = paste0(dir1,"/"),
output_file = paste0(runVersion,"_Summary.html"),
params = list(
reportData = conservationSummary),
envir = new.env(parent = globalenv())
# clean = F,
# encoding = "utf-8"
)
)
# run summary html
try(
rmarkdown::render(input = "R2/summarize/runSummary.Rmd",
output_format = "html_document",
output_dir = paste0(dir1,"/"),
output_file = paste0(runVersion,"_Summary.html"),
params = list(
reportData = conservationSummary),
envir = new.env(parent = globalenv())
# clean = F,
# encoding = "utf-8"
)
)
r1 <- terra::rast("~/trueNAS/work/cwr_wildgrapes/data/datasetsForPublication/grsin_map.tif")
r1 <- terra::rast("~/trueNAS/work/cwr_wildgrapes/data/datasetsForPublication/grsIn_map.tif")
r1
terra::plot(r1)
r1 <- terra::rast("~/trueNAS/work/cwr_wildgrapes/data/datasetsForPublication/grsEx_map.tif")
r1 <- terra::rast("~/trueNAS/work/cwr_wildgrapes/data/datasetsForPublication/grsEX_map.tif")
r1
terra::plot(r1)
pacman::p_load(dplyr,readr, tidyr)
# load in species
species <- read_csv(
"data/datasetsForPublication/allSpeciesOccurrences.csv"
)|>
dplyr::distinct(taxon) |>
tidyr::drop_na()|>
dplyr::pull()
p1
species <- species[1]
species
species
# output list
# base path
p1 <- paste0("data/Vitis/", species,"/run08282025_1k")
# AUC data
p2 <- paste0(p1, "/results/evaluationTable.csv")
p4 <- paste0(p1, "/occurances/allmodelData.csv") |>
read_csv()
p4
names(p4)
p4 <- paste0(p1, "/occurances/allmodelData.csv") |>
read_csv() |>
dplyr::filter(presence ==1)|>
dplyr::select(-"geometry") |>
dplyr::mutate(taxon = species)
p4
p4 <- paste0(p1, "/occurances/allmodelData.csv") |>
read_csv() |>
dplyr::filter(presence ==1)|>
dplyr::mutate(taxon = species) |>
dplyr::select(taxon, everything(),-"geometry" )
p4
gatherModelStats <- function(species){
# output list
# base path
p1 <- paste0("data/Vitis/", species,"/run08282025_1k")
# AUC data
p2 <- paste0(p1, "/results/evaluationTable.csv")
if(!file.exists(p2)){
return(NULL)
}
# variable selection
p3 <- paste0(p1, "/occurances/variableSelectionData.csv")
p4 <- paste0(p1, "/occurances/allmodelData.csv") |>
read_csv() |>
dplyr::filter(presence ==1)|>
dplyr::mutate(taxon = species) |>
dplyr::select(taxon, everything(),-"geometry" )
# export
output  <- list(
auc = read_csv(p2) |>
dplyr::mutate(taxon = species),
varSelection = read_csv(p3)|>
dplyr::mutate(taxon = species),
modelData = p4
)
return(output)
}
results <- purrr::map(.x = species, .f = gatherModelStats)
results
dim(results)
length(results)
results[[1]]
# 3. Extract and combine the 'varSelection' dataframes
model_data <- results |>
purrr::map("modelData") |>
purrr::list_rbind(names_to = "species") |>
dplyr::select(
"taxon", everything(), -species
)
model_data
View(modelData)
# load in species
species <- read_csv(
"data/datasetsForPublication/allSpeciesOccurrences.csv"
)|>
dplyr::distinct(taxon) |>
tidyr::drop_na()|>
dplyr::pull()
gatherModelStats <- function(species){
# output list
# base path
p1 <- paste0("data/Vitis/", species,"/run08282025_1k")
# AUC data
p2 <- paste0(p1, "/results/evaluationTable.csv")
if(!file.exists(p2)){
return(NULL)
}
# variable selection
p3 <- paste0(p1, "/occurances/variableSelectionData.csv")
p4 <- paste0(p1, "/occurances/allmodelData.csv") |>
read_csv() |>
dplyr::filter(presence ==1)|>
dplyr::mutate(taxon = species) |>
dplyr::select(taxon, everything(),-"geometry" )
# export
output  <- list(
auc = read_csv(p2) |>
dplyr::mutate(taxon = species),
varSelection = read_csv(p3)|>
dplyr::mutate(taxon = species),
modelData = p4
)
return(output)
}
results <- purrr::map(.x = species, .f = gatherModelStats)
# 2. Extract and combine the 'auc' dataframes
all_auc <- results |>
purrr::map("auc") |>  # Extract the 'auc' element from every sub-list
purrr::list_rbind(names_to = "species") |>
dplyr::select(
"taxon", everything(), -species
)
write_csv(all_auc, "data/datasetsForPublication/modelEvaluations.csv")
# 3. Extract and combine the 'varSelection' dataframes
all_vars <- results |>
purrr::map("varSelection") |>
purrr::list_rbind(names_to = "species") |>
dplyr::select(
"taxon", everything(), -species
)
write_csv(all_auc, "data/datasetsForPublication/variableSelections.csv")
head(all_vars)
# 3. Extract and combine the 'varSelection' dataframes
model_data <- results |>
purrr::map("modelData") |>
purrr::list_rbind(names_to = "species") |>
dplyr::select(
"taxon", everything(), -species
)
write_csv(all_auc, "data/datasetsForPublication/modelData.csv")
write_csv(model_data, "data/datasetsForPublication/modelData.csv")
View(model_data)
write_csv(all_vars, "data/datasetsForPublication/variableSelections.csv")
write_csv(all_vars, "data/datasetsForPublication/variableSelections.csv")
# 3. Extract and combine the 'varSelection' dataframes
model_data <- results |>
purrr::map("modelData") |>
purrr::list_rbind(names_to = "species") |>
dplyr::select(
"taxon", everything(), -species
)
write_csv(model_data, "data/datasetsForPublication/modelData.csv")
